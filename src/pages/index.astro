---
import Layout from "../layouts/Layout.astro";

import Hero from "../components/sections/hero/Hero.astro";
import About from "../components/sections/about/About.astro";
import LandPreviews from "../components/sections/land-previews/LandPreviews.astro";
---

<Layout title="Viet Land" currentPage="/">
  <Hero />
  <LandPreviews />
  <About />
</Layout>

<!-- Smooth scroll functionality - css classes requred by Lenis library -->
<style is:global>
  html.lenis {
    height: auto !important;
  }
  .lenis.lenis-smooth {
    scroll-behavior: auto !important;
  }
  .lenis.lenis-smooth [data-lenis-prevent] {
    overscroll-behavior: contain !important;
  }
  .lenis.lenis-stopped {
    overflow: hidden !important;
  }
  .lenis.lenis-scrolling iframe {
    pointer-events: none !important;
  }
</style>

<!-- Hide and show animations of navigation bar in header, triggered by scroll -->
<style is:global lang="sass">
  header

  header[scroll-hide="true"]
    transform: translateY(-50px)
    opacity: 0
    transition: transform .6s ease, opacity .4s ease

  header[scroll-hide="false"]
    transform: translateY(0%)
    opacity: 1
    transition: transform .6s ease, opacity .4s .1s ease
</style>

<script>
  import LocomotiveScroll from "locomotive-scroll";

  import isMobileDevice from "../scripts/isMobileDevice.js";

  // const navbar headerEl.setAttribute("hide", this.isOpen.toString());

  const headerEl = document.querySelector("header") as HTMLElement;
  let isHeaderVisible = true;

  const buttonDownEl = document.getElementById("button-down") as HTMLElement;
  const landPreviewsEl = document.getElementById(
    "land-previews"
  ) as HTMLElement;

  // Allow smooth scrolling only on desktop devices
  if (!isMobileDevice()) {
    const mainContentContainer = document.querySelector(
      ".main-content"
    ) as HTMLElement;

    const footer = document.querySelector("footer") as HTMLElement;

    function onScroll({ scroll, limit, velocity, direction, progress }) {
      // console.log(scroll, limit, velocity, direction, progress);

      if (isHeaderVisible && direction === 1 && scroll >= 201) {
        isHeaderVisible = false;

        headerEl.setAttribute("scroll-hide", "true");
      }

      if (!isHeaderVisible && direction === -1 && scroll <= 299) {
        isHeaderVisible = true;

        headerEl.setAttribute("scroll-hide", "false");
      }
    }

    const locomotiveScroll = new LocomotiveScroll({
      lenisOptions: {
        wrapper: mainContentContainer,

        // content: mainContentContainer,
      },
      scrollCallback: onScroll,
    });

    // Scroll from hero section down to land previews section
    buttonDownEl.addEventListener("click", () => {
      const deltaY =
        window.innerHeight - landPreviewsEl.getBoundingClientRect().top;

      locomotiveScroll.scrollTo(landPreviewsEl, {
        duration: 1.4 * (1 - deltaY / window.innerHeight),
        easing: (t) => {
          return 1 - Math.pow(1 - t, 4);
        },
      });
    });
  }

  window.addEventListener("scrollEvent", (e) => {
    const { target, way, from } = e.detail;
    console.log(`target: ${target}`, `way: ${way}`, `from: ${from}`);
  });
</script>
